<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="center">
    <h1 id="title">Countdown!</h1>
    <p id="date">...loading...</p>
	<p id="demo">...loading...</p>
</div>

<script>
    // from https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    function writeText(id, text) {
        document.getElementById(id).innerHTML = text;
    }

    function applyTitle() {
        var title = getParameterByName("title");

        if (title && title !== "") {
            let parsedTitle = title.replaceAll("_", " ");
            writeText("title", parsedTitle);
        }
    }

    function applyDate() {
        // from https://www.w3schools.com/howto/howto_js_countdown.asp

        // Set the date we're counting down to
        var countDownDate = new Date("Jan 01, 2030 0:00:00").getTime();
        // Get today's date and time
        var now = new Date().getTime();
        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // If the count down is finished, write some text
        if (distance < 0) {
            clearInterval(x);
            document.getElementById("demo").innerHTML = "PAST";
        } else {
            // Time calculations for days, hours, minutes and seconds
            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Display the result in the element with id="demo"
            const remainingTime = days + " days " + hours + " hours " + minutes + " minutes " + seconds + " seconds ";
            document.getElementById("demo").innerHTML = remainingTime;
        }
    }

    // Update the count down every 1 second
    var x = setInterval(function () {
        applyTitle();
        applyDate();
    }, 1000);

</script>

</body>
</html>
